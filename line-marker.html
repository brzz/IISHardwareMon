<!DOCTYPE html>
<html style="height: 100%">
<head>
    <meta charset="utf-8">
</head>
<body style="height: 100%; margin: 0">
    <script src="js/jquery-3.1.0.min.js"></script>
    <script>
        var raw;

        //var datx = new Array(); //x-y图需要 time图不用
        var daty = new Array();

        function ConvertJsontoArray(jsonarry) {

            jsonarry.forEach(function (value, index, array) {
                var t = new Array();
                t.push(parseInt(value.InsertTime + '000'));
                t.push(value.Value)
                daty.push(t);
                //datx.push(value.InsertTime);
            });


        }


        function Getdata() {


            //$.ajaxSettings.async = false;//同步加载ajax，防止在加载AJAX时候EASYUI已经开始加载导致数据不对

            $.ajax({
                type: "POST",
                url: "ShowData.aspx/GetData",
                data: "{ getCount: '0' }", //可选参数
                dataType: "json",
                contentType: 'application/json;charset=utf-8', // 设置请求头信息
                success: function (data) {

                    myChart.hideLoading();

                    raw = data;

                    ConvertJsontoArray(data.d.rows);

                    // 填入数据
                    myChart.setOption({
                        //xAxis: {
                        //    data: datx
                        //},
                        series: [{
                            type: 'line',
                            // 根据名字对应到相应的系列
                            name: '温度',
                            data: daty
                        }]
                    });
                },

                error: function (errorMsg) {
                    //请求失败时执行该函数
                    alert("请求数据失败!");
                    myChart.hideLoading();
                }
            }
            );

            //$.ajaxSettings.async = true;//异步加载ajax
        }


    </script>

    <script type="text/javascript" src="js/echarts.js"></script>

    <div id="container" style="height: 100%"></div>

    <script type="text/javascript">
        var dom = document.getElementById("container");
        var myChart = echarts.init(dom);
        var app = {};
        option = null;
        option = {
            title: {
                text: '硬件温度变化',
                subtext: '物理机器'
            },
            tooltip: {
                trigger: 'axis'
            },
            //legend: {
            //    data: ['最高温', '最低温']
            //},
            toolbox: {
                show: true,
                feature: {
                    dataZoom: {
                        yAxisIndex: 'none'
                    },
                    dataView: { readOnly: false },
                    magicType: { type: ['line', 'bar'] },
                    restore: {},
                    saveAsImage: {}
                }
            },
            xAxis: {
                //X轴设置
                type: 'time',//'category',
                axisTick: {
                    alignWithLabel: true
                },
                //axisLine: {
               //     onZero: false,
               // },
                //boundaryGap: true,
                //data: []
            },
            dataZoom: [{
                //X轴滚动条
                type: 'slider',
                show: true,
                xAxisIndex: [0],
                left: '9%',
                bottom: -5,
                start: 0,
                end: 100 //初始化滚动条位置
            }],

            yAxis: {
                //Y轴设置
                type: 'value',
                scale: true,//自动调节
                axisLabel: {
                    formatter: '{value} °C'
                }
            },
            series: [
                {
                    name: '最高温',
                    type: 'line',
                    smooth: true,//平滑
                    data: [],
                    markPoint: {
                        data: [
                            { type: 'max', name: '最大值' },
                            { type: 'min', name: '最小值' }
                        ]
                    },
                    markLine: {
                        data: [
                            { type: 'average', name: '平均值' }
                        ]
                    }
                },

                //{
                //    name:'最低温',
                //    type:'line',
                //    data:[1, -2, 2, 5, 3, 2, 0],
                //    markPoint: {
                //        data: [
                //            {name: '周最低', value: -2, xAxis: 1, yAxis: -1.5}
                //        ]
                //    },
                //    markLine: {
                //        data: [
                //            {type: 'average', name: '平均值'},
                //            [{
                //                symbol: 'none',
                //                x: '90%',
                //                yAxis: 'max'
                //            }, {
                //                symbol: 'circle',
                //                label: {
                //                    normal: {
                //                        position: 'start',
                //                        formatter: '最大值'
                //                    }
                //                },
                //                type: 'max',
                //                name: '最高点'
                //            }]
                //        ]
                //    }
                //}
            ]
        };

        myChart.showLoading(); //loading动画

        Getdata();
        ;
        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }

    </script>

</body>
</html>